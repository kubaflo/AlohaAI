<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AlohaAI.ViewModels"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             x:Class="AlohaAI.Views.HomePage"
             x:DataType="vm:HomeViewModel"
             Title="Home"
             Shell.NavBarIsVisible="False"
             SafeAreaEdges="None">
    <Grid>
        <!-- Layer 0: Background Image -->
        <Image Source="bg_sunset.png" Aspect="AspectFill" InputTransparent="True" />
        <!-- Layer 1: Subtle vignette overlay -->
        <BoxView InputTransparent="True">
            <BoxView.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#05000000" Offset="0.0" />
                    <GradientStop Color="#22000000" Offset="0.6" />
                    <GradientStop Color="#2A000000" Offset="1.0" />
                </LinearGradientBrush>
            </BoxView.Background>
        </BoxView>

        <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}"
                           HorizontalOptions="Center" VerticalOptions="Center"
                           Color="{StaticResource Primary}" ZIndex="99" />
    <ScrollView>
        <VerticalStackLayout x:Name="MainContent" Spacing="0">

            <!-- Header: Logo + Settings -->
            <Grid Padding="24,70,24,0" ColumnDefinitions="*,Auto">
                <VerticalStackLayout Spacing="2">
                    <Image Source="mascot.png" WidthRequest="92" HeightRequest="92"
                           HorizontalOptions="Start" Margin="0,0,0,6" />
                    <Image Source="icon_logotext.png" WidthRequest="240" HeightRequest="60"
                           Aspect="AspectFit" HorizontalOptions="Start" />
                </VerticalStackLayout>
                <Image Grid.Column="1" Source="icon_gem.png" WidthRequest="34" HeightRequest="34"
                       VerticalOptions="Start" Margin="0,10,0,0" Opacity="0.85" />
            </Grid>

            <!-- Welcome text -->
            <Label Text="Aloha! Welcome back!"
                   FontSize="22"
                   FontFamily="OpenSansSemibold"
                   TextColor="White"
                   Padding="24,12,24,20" />

            <!-- Learning Paths as rich cards -->
            <VerticalStackLayout Padding="16,0,16,120" Spacing="14">
                <CollectionView ItemsSource="{Binding PathItems}" SelectionMode="None">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="14" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="vm:HomePathItem">
                            <Border StrokeShape="RoundRectangle 20" StrokeThickness="1" Padding="18,16">
                                <Border.BackgroundColor>
                                    <Color>#99201530</Color>
                                </Border.BackgroundColor>
                                <Border.Stroke>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#35FFFFFF" Offset="0.0" />
                                        <GradientStop Color="#08FFFFFF" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Border.Stroke>
                                <Border.Shadow>
                                    <Shadow Brush="#000000" Offset="0,8" Radius="24" Opacity="0.4" />
                                </Border.Shadow>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HomeViewModel}}, Path=NavigateToPathCommand}"
                                        CommandParameter="{Binding Id}" />
                                </Border.GestureRecognizers>
                                <VerticalStackLayout Spacing="12">
                                    <!-- Row 1: Icon + Title + Trophy Score -->
                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="14">
                                        <Border BackgroundColor="{Binding Color}" StrokeShape="RoundRectangle 36"
                                                Stroke="Transparent" WidthRequest="72" HeightRequest="72">
                                            <Border.Shadow>
                                                <Shadow Brush="{Binding Color}" Offset="0,4" Radius="14" Opacity="0.6" />
                                            </Border.Shadow>
                                            <Image Source="{Binding IconImage}" WidthRequest="48" HeightRequest="48"
                                                   HorizontalOptions="Center" VerticalOptions="Center" />
                                        </Border>
                                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="3">
                                            <Label Text="{Binding Title}" FontSize="20" FontAttributes="Bold"
                                                   FontFamily="OpenSansSemibold" TextColor="White" />
                                            <Label Text="{Binding ProgressText}" FontSize="15"
                                                   TextColor="#BBBBBB" />
                                        </VerticalStackLayout>
                                        <HorizontalStackLayout Grid.Column="2" VerticalOptions="Start" Spacing="4" Margin="0,4,0,0">
                                            <Image Source="icon_trophy.png" WidthRequest="22" HeightRequest="22"
                                                   VerticalOptions="Center" />
                                            <Label Text="{Binding CompletedLessons, StringFormat='{0}/{1}'}"
                                                   FontSize="15" FontAttributes="Bold" TextColor="#FFD54F"
                                                   VerticalOptions="Center">
                                                <Label.Text>
                                                    <MultiBinding StringFormat="{}{0}/{1}">
                                                        <Binding Path="CompletedLessons" />
                                                        <Binding Path="TotalLessons" />
                                                    </MultiBinding>
                                                </Label.Text>
                                            </Label>
                                        </HorizontalStackLayout>
                                    </Grid>

                                    <!-- Row 2: Tags -->
                                    <HorizontalStackLayout Spacing="8">
                                        <Border BackgroundColor="#30FFD700" StrokeShape="RoundRectangle 8"
                                                Stroke="Transparent" Padding="10,4">
                                            <Label Text="Course" FontSize="11" TextColor="#FFD700"
                                                   FontAttributes="Bold" />
                                        </Border>
                                        <Border BackgroundColor="#305B8FD4" StrokeShape="RoundRectangle 8"
                                                Stroke="Transparent" Padding="10,4">
                                            <Label Text="{Binding LevelTag}" FontSize="11" TextColor="#8BB8F4"
                                                   FontAttributes="Bold" />
                                        </Border>
                                    </HorizontalStackLayout>

                                    <!-- Row 3: Multi-segment progress bar -->
                                    <Grid HeightRequest="6">
                                        <Border BackgroundColor="#20FFFFFF" StrokeShape="RoundRectangle 3"
                                                Stroke="Transparent" />
                                        <Border StrokeShape="RoundRectangle 3" Stroke="Transparent"
                                                HorizontalOptions="Start"
                                                WidthRequest="{Binding Progress, Converter={StaticResource ProgressToWidthConverter}, ConverterParameter=300}">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                    <GradientStop Color="#FF6B6B" Offset="0.0" />
                                                    <GradientStop Color="#FFD54F" Offset="0.35" />
                                                    <GradientStop Color="#4CAF50" Offset="0.65" />
                                                    <GradientStop Color="#5B8FD4" Offset="1.0" />
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <Border.Shadow>
                                                <Shadow Brush="{Binding Color}" Offset="0,0" Radius="6" Opacity="0.6" />
                                            </Border.Shadow>
                                        </Border>
                                    </Grid>

                                    <!-- Row 4: Continue hint -->
                                    <Label Text="{Binding ContinueText}" FontSize="13" TextColor="#AAAAAA"
                                           MaxLines="1" LineBreakMode="TailTruncation"
                                           IsVisible="{Binding HasContinueText}" />
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
    </Grid>
</ContentPage>
